<!DOCTYPE html>
<html>
<head>
    <title>gomoku</title>
</head>
<style type="text/css">
    .main-content {
        position: relative;
        background-image: url(./wood.jpg);
        background-repeat: no-repeat;
        background-size: 700px;
        margin: 0 auto;
        height: 100%;
        box-shadow: 0px 0px 10px #000;
    }

    .options {
        position: absolute;
        top: 80px;
        right: 50px;
    }

    .options div {
        width: 150px;
        height: 40px;
        font-size: 16px;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 1px 1px #333;
        line-height: 40px;
        text-align: center;
    }

    .board-content {
        font-size: 0;
        width: 600px;
        margin-left: 50px;
        padding: 55px;
    }

    .board-item {
        display: inline-block;
        width: 40px;
        height: 40px;
        position: relative;
    }

    .row {
        position: absolute;
        height: 1px;
        width: 100%;
        content: ' ';
        background-color: #444;
        top: 20px;
    }

    .column {
        position: absolute;
        width: 1px;
        height: 100%;
        content: ' ';
        background-color: #444;
        left: 19px;
    }

    .row-left-top {
        position: absolute;
        width: 2px;
        height: 50%;
        content: ' ';
        background-color: #444;
        left: 20px;
        top: 20px;
    }

    .column-left-top {
        position: absolute;
        height: 2px;
        width: 50%;
        content: ' ';
        background-color: #444;
        left: 20px;
        top: 20px;
    }

    .row-right-top {
        position: absolute;
        width: 2px;
        height: 50%;
        content: ' ';
        background-color: #444;
        right: 20px;
        top: 20px;
    }

    .column-right-top {
        position: absolute;
        height: 2px;
        width: 50%;
        content: ' ';
        background-color: #444;
        right: 20px;
        top: 20px;
    }

    .row-left-bottom {
        position: absolute;
        width: 2px;
        height: 50%;
        content: ' ';
        background-color: #444;
        left: 20px;
        bottom: 20px;
    }

    .column-left-bottom {
        position: absolute;
        height: 2px;
        width: 50%;
        content: ' ';
        background-color: #444;
        left: 20px;
        bottom: 20px;
    }

    .row-right-bottom {
        position: absolute;
        width: 2px;
        height: 50%;
        content: ' ';
        background-color: #444;
        right: 20px;
        bottom: 20px;
    }

    .column-right-bottom {
        position: absolute;
        height: 2px;
        width: 50%;
        content: ' ';
        background-color: #444;
        right: 20px;
        bottom: 20px;
    }

    .row-top {
        position: absolute;
        height: 2px;
        width: 100%;
        content: ' ';
        background-color: #444;
        top: 20px;
    }

    .column-top {
        position: absolute;
        width: 1px;
        height: 50%;
        content: ' ';
        background-color: #444;
        top: 20px;
        left: 19px;
    }

    .row-bottom {
        position: absolute;
        height: 2px;
        width: 100%;
        content: ' ';
        background-color: #444;
        bottom: 20px;
    }

    .column-bottom {
        position: absolute;
        width: 1px;
        height: 50%;
        content: ' ';
        background-color: #444;
        bottom: 20px;
        left: 19px;
    }

    .row-left {
        position: absolute;
        height: 1px;
        width: 50%;
        content: ' ';
        background-color: #444;
        left: 20px;
        top: 20px;
    }

    .column-left {
        position: absolute;
        width: 2px;
        height: 100%;
        content: ' ';
        background-color: #444;
        left: 20px;
    }

    .row-right {
        position: absolute;
        height: 1px;
        width: 50%;
        content: ' ';
        background-color: #444;
        right: 20px;
        top: 20px;
    }

    .column-right {
        position: absolute;
        width: 2px;
        height: 100%;
        content: ' ';
        background-color: #444;
        right: 20px;
    }

    .black:before {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 1000px;
        content: ' ';
        z-index: 1;
        background: -webkit-radial-gradient(30% 25%, circle closest-corner, #777, #222);
        background: -moz-radial-gradient(30% 25%, circle closest-corner, #777, #222);
        background: -o-radial-gradient(30% 25%, circle closest-corner, #777, #222);
        background: -ms-radial-gradient(30% 25%, circle closest-corner, #777, #222);
        background: radial-gradient(30% 25%, circle closest-corner, #777, #222);
        -webkit-box-shadow: inset 0 -2px 15px rgba(255, 255, 255, .3), inset -2px -1px 40px rgba(10, 10, 10, .4), 0 0 2px rgba(0, 0, 0, .5);
        box-shadow: inset 0 -2px 15px rgba(255, 255, 255, .3), inset -2px -1px 40px rgba(10, 10, 10, .4), 0 0 2px rgba(0, 0, 0, .5);
        -webkit-transform: scale(.9);
        -moz-transform: scale(.9);
        -o-transform: scale(.9);
        -ms-transform: scale(.9);
        transform: scale(.9);
    }

    .white:before {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 1000px;
        content: ' ';
        z-index: 1;
        background: -webkit-radial-gradient(30% 25%, circle closest-corner, #fff, #eee);
        background: -moz-radial-gradient(30% 25%, circle closest-corner, #fff, #eee);
        background: -o-radial-gradient(30% 25%, circle closest-corner, #fff, #eee);
        background: -ms-radial-gradient(30% 25%, circle closest-corner, #fff, #eee);
        background: radial-gradient(30% 25%, circle closest-corner, #fff, #eee);
        -webkit-box-shadow: inset 0 -2px 15px rgba(255, 255, 255, .3), inset -2px -1px 40px rgba(10, 10, 100, .4), 0 0 2px rgba(0, 0, 0, .5);
        box-shadow: inset 0 -2px 15px rgba(255, 255, 255, .3), inset -2px -1px 40px rgba(10, 10, 100, .4), 0 0 2px rgba(0, 0, 0, .5);
        -webkit-transform: scale(.9);
        -moz-transform: scale(.9);
        -o-transform: scale(.9);
        -ms-transform: scale(.9);
        transform: scale(.9);
    }

    .options > div {
        border: 1px solid #c27426;
        background: #c27426;
        font-weight: 700;
        color: #fff;
        text-shadow: 0 1px 1px #444;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#D57F29), to(#AE6822));
        background-image: -webkit-linear-gradient(#D57F29, #AE6822);
        background-image: -moz-linear-gradient(#D57F29, #AE6822);
        background-image: -ms-linear-gradient(#D57F29, #AE6822);
        background-image: -o-linear-gradient(#D57F29, #AE6822);
        background-image: linear-gradient(#D57F29, #AE6822);
        margin-bottom: 30px;
    }
</style>
<body>
<div class="main">
    <div class="main-content">
        <div class="chessboard"></div>
        <div class="options">
            <div class="mode">双人</div>
            <div class="restart">重新开始</div>
            <div class="undo">悔棋</div>
        </div>
    </div>

</div>

<script type="text/javascript">
    (function () {

        var boardSize = 20, // 棋盘数
            chessData = new Array(boardSize),  // 棋盘数据
            turnTo = 'black',  // 轮到的下棋方
            winnerLock = false,
            cacheData = [],
            mode = 1; // 1 双人 2 人机

        for (var i = 0; i < boardSize; i++) {
            chessData[i] = new Array(boardSize);

            for (var j = 0; j < boardSize; j++) {
                chessData[i][j] = 0;
            }
        }
        // 初始化
        init();
        bindEvent();

        function init() {
            setTimeout(function () {
                calWidth();
            }, 0);

            drawBoard();
        }

        // 根据棋盘数调整棋盘位置
        function calWidth() {
            document.getElementsByClassName('board-content')[0].style.width = boardSize * 40 + 'px';
            document.getElementsByClassName('main-content')[0].style.backgroundSize = boardSize * 40 + 400 + 'px';
            document.getElementsByClassName('main-content')[0].style.width = boardSize * 40 + 400 + 'px';
        }

        // 画棋盘
        function drawBoard() {
            var target = document.getElementsByClassName('chessboard'),
                boardDom = '';

            for (var i = 0; i < boardSize * boardSize; i++) {
                if (i === 0) {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row-left-top"></div><div class="column-left-top"></div></li>';
                } else if (i === boardSize - 1) {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row-right-top"></div><div class="column-right-top"></div></li>';
                } else if (i === boardSize * (boardSize - 1)) {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row-left-bottom"></div><div class="column-left-bottom"></div></li>';
                } else if (i === boardSize * boardSize - 1) {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row-right-bottom"></div><div class="column-right-bottom"></div></li>';
                } else if (i < boardSize) {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row-top"></div><div class="column-top"></div></li>';
                } else if (i % boardSize === 0) {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row-left"></div><div class="column-left"></div></li>';
                } else if ((i + 1) % boardSize === 0) {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row-right"></div><div class="column-right"></div></li>';
                } else if (i < boardSize * boardSize && i > boardSize * (boardSize - 1)) {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row-bottom"></div><div class="column-bottom"></div></li>';
                } else {
                    boardDom += '<li class = "board-item" data-row="' + i % boardSize + '" data-column="' + parseInt(i / boardSize) + '" data-main="' + i % boardSize + '-' + parseInt(i / boardSize) + '"><div class="row"></div><div class="column"></div></li>';
                }
            }

            target[0].innerHTML = '<ul class="board-content">' + boardDom + '</ul>';
        }

        // 下棋
        function playChess(e) {
            var target = e.target.children.length === 0 ? e.target.parentElement : e.target,
                className = target.className;

            if (className.indexOf('black') <= -1 && className.indexOf('white') <= -1 && className !== 'board-content' && !winnerLock) {

                var rowNum = parseInt(target.dataset.row),
                    columnNum = parseInt(target.dataset.column),
                    now = turnTo === 'black' ? 1 : 2;

                if (turnTo === 'black') {
                    turnTo = 'white';
                    target.className = className + ' black';

                    chessData[rowNum][columnNum] = 1;
                } else {
                    turnTo = 'black';
                    target.className = className + ' white';

                    chessData[rowNum][columnNum] = 2;
                }

                cacheData.push([rowNum, columnNum]);

                checkWinner(now, rowNum, columnNum);  // 1 黑 2 白
            }

        }

        // 判断胜负
        function checkWinner(now, row, col) {
            // 四种赢得可能性
            var p1 = 0,
                p2 = 0,
                p3 = 0,
                p4 = 0;

            // 左
            for (var a = 1; chessData[row - a][col] === now; a++) {
                p1++;
            }
            // 左上
            for (var b = 1; chessData[row - b][col - b] === now; b++) {
                p2++;
            }
            // 上
            for (var c = 1; chessData[row][col - c] === now; c++) {
                p3++;
            }
            // 右上
            for (var d = 1; chessData[row + d][col - d] === now; d++) {
                p4++;
            }
            // 右
            for (var e = 1; chessData[row + e][col] === now; e++) {
                p1++;
            }
            // 右下
            for (var f = 1; chessData[row + f][col + f] === now; f++) {
                p2++;
            }
            // 下
            for (var g = 1; chessData[row][col + g] === now; g++) {
                p3++;
            }
            // 左下
            for (var h = 1; chessData[row - h][col + h] === now; h++) {
                p4++;
            }

            if (p1 >= 4 || p2 >= 4 || p3 >= 4 || p4 >= 4) {
                setTimeout(function () {
                    alert(now === 1 ? '黑方胜！' : '白方胜！');
                }, 100);
                winnerLock = true;
            }
        }

        function bindEvent() {
            document.getElementsByClassName('board-content')[0].addEventListener('click', function (e) {
                playChess(e);
            });
            document.getElementsByClassName('restart')[0].addEventListener('click', function (e) {
                restart(e);
            });
            document.getElementsByClassName('undo')[0].addEventListener('click', function (e) {
                undo(e);
            });
            document.getElementsByClassName('mode')[0].addEventListener('click', function (e) {
                changeMode(e);
            });
        }

        function restart(e) {
            chessData = new Array(boardSize);  // 棋盘数据
            turnTo = 'black';  // 轮到的下棋方
            winnerLock = false;
            cacheData = [];

            for (var i = 0; i < boardSize; i++) {
                chessData[i] = new Array(boardSize);

                for (var j = 0; j < boardSize; j++) {
                    chessData[i][j] = 0;
                }
            }

            init();
        }

        function undo(e) {
            if (!cacheData || cacheData.length === 0) {
                alert('你不下我没法悔');
                return false;
            }

            var lastData = cacheData.pop(),
                target = document.querySelector('[data-main= "' + lastData[0] + '-' + lastData[1] + '"]');

            target.className = target.className.replace('black', '').replace('white', '');

            chessData[lastData[0]][lastData[1]] = 0;

            turnTo = turnTo === 'black' ? 'white' : 'black';
        }

        function changeMode(e) {
            var now_mode = e.currentTarget.innerText;

            if (confirm('切换模式当前进度将丢失，是否切换？')) {
                now_mode === '双人' ? e.currentTarget.innerHTML = '人机' : e.currentTarget.innerHTML = '双人';
                mode === 1 ? mode = 2 : mode = 1
                restart();
            }
        }

        function computerPlay() {

        }
    })();

</script>
</body>
</html>